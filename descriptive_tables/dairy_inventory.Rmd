---
title: "SDVC Final Report Descriptive Tables"
subtitle: "Dairy Cattle Inventory and Milk Production"
author: "Julia Silge"
date: "`r Sys.Date()`"
output: html_document
---

```{r, echo = FALSE, warning = FALSE}
library(knitr)
knitr::opts_chunk$set(cache = TRUE, warning = FALSE, message = FALSE, dpi = 180)
options(width=80, dplyr.width = 150)
library(ggplot2)
theme_set(theme_light())
```

Before we make some pretty tables, let's read in the data.

```{r}
library(readr)
library(forcats)
library(dplyr)
library(reshape2)
gpf_ppt <- read_csv("../data/gpf_ppt_merged.csv", 
                    col_types = cols(.default = col_character()))
dim(gpf_ppt)

gpf_ppt <- gpf_ppt %>%
    mutate(round_month = fct_recode(round,
                              `Jul 2014` = '1.0',
                              `Dec 2014` = '2.0',
                              `Jul 2015` = '3.0',
                              `Dec 2015` = '4.0',
                              `Jul 2016` = '5.0')) %>%
    mutate(household_type = fct_collapse(household_type,
                                         Treatment = c("1", "2", "3"),
                                         Control = c("4", "5", "6")))

gpf_ppt[,c(1,36,273:276)] <- lapply(gpf_ppt[,c(1,36,273:276)], as.numeric)
gpf_ppt$district_gpf[gpf_ppt$district_gpf == "pabna"] <- "Pabna"
gpf_ppt$district_gpf[gpf_ppt$district_gpf == "Jaipur Hat"] <- "Joypurhat"
gpf_ppt$district_gpf[gpf_ppt$district_gpf == "Natore"] <- "Nator"
gpf_ppt$district_gpf[gpf_ppt$district_gpf == "Shirajgong"] <- "Sirajgonj"
gpf_ppt$district_gpf[gpf_ppt$district_gpf == "Shirajgonj"] <- "Sirajgonj"
gpf_ppt$district_gpf[gpf_ppt$district_gpf == "Sirajgang"] <- "Sirajgonj"
gpf_ppt$district_gpf[gpf_ppt$district_gpf == "Sirajganj"] <- "Sirajgonj"

```

## 1. Cattle inventory by household, by district

```{r, fig.width=7, fig.height=7}
df <- bind_rows(gpf_ppt %>% 
                    filter(round_month == 'Jul 2014') %>% 
                    group_by(district_gpf, household_type, entry_id) %>% 
                    summarize(cows = n()) %>% 
                    mutate(deo_id = entry_id,
                           round_month = 'Jul 2014'),
                gpf_ppt %>% 
                    filter(round_month == 'Jul 2016') %>% 
                    group_by(district_gpf, household_type, deo_id) %>% 
                    summarize(cows = n()) %>% 
                    mutate(round_month = 'Jul 2016')) %>%
    group_by(round_month, district_gpf, household_type) %>%
    summarize(median = median(cows, na.rm = TRUE)) %>%
    filter(!is.na(median))

df %>% 
    kable(digits = 0,
          col.names = c("Round of Data Collection", "District", "Treatment/Control",
                        "Median Number of Cattle per Household"),
          caption = "Treatment and Control Groups at the First and Last Data Collection Rounds")

ggplot(df, aes(round_month, median, fill = household_type)) +
    geom_bar(stat = "identity", position = "dodge") +
    facet_wrap(~district_gpf) +
    labs(x = NULL, y = "Median Number of Cattle per Household") +
    theme(legend.title=element_blank())
```

```{r, fig.width=7, fig.height=8}
df <- bind_rows(gpf_ppt %>% 
                    filter(round_month == 'Jul 2014' & household_type == "Treatment") %>% 
                    group_by(district_gpf, entry_id) %>% 
                    summarize(cows = n()) %>% 
                    mutate(deo_id = entry_id,
                           round_month = 'Jul 2014'),
                gpf_ppt %>% 
                    filter(round_month %in% c('Dec 2014', 'Jul 2015','Dec 2015', 'Jul 2016') & household_type == "Treatment") %>% 
                    group_by(round_month, district_gpf, deo_id) %>% 
                    summarize(cows = n())) %>%
    ungroup %>%
    mutate(round_month = fct_relevel(round_month,
                              'Jul 2014',
                              'Dec 2014',
                              'Jul 2015',
                              'Dec 2015',
                              'Jul 2016')) %>%
    group_by(round_month, district_gpf) %>%
    summarize(median = median(cows, na.rm = TRUE)) %>%
    filter(!is.na(median)) 

df %>%
    kable(digits = 0,
          col.names = c("Round of Data Collection", "District", 
                        "Median Number of Cattle per Household"),
          caption = "Treatment Group at All Data Collection Rounds")

ggplot(df, aes(round_month, median)) +
    geom_bar(stat = "identity") +
    facet_wrap(~ district_gpf) +
    labs(x = NULL, y = "Median Number of Cattle per Household") +
    theme(axis.text.x= element_text(angle=45, hjust = 1))

```

## 2. Number of local breed cattle per household, per district

```{r, fig.width=7, fig.height=7}
df <- bind_rows(gpf_ppt %>% 
              filter(round_month == 'Jul 2014') %>% 
              filter(cow_breed == 1) %>% 
              group_by(district_gpf, household_type, entry_id) %>% 
              summarize(cows = n()) %>% 
              mutate(deo_id = entry_id,
                     round_month = 'Jul 2014'),
          gpf_ppt %>% 
              filter(round_month == 'Jul 2016') %>% 
              filter(cow_breed == 1) %>% 
              group_by(district_gpf, household_type, deo_id) %>% 
              summarize(cows = n()) %>% 
              mutate(round_month = 'Jul 2016')) %>%
    group_by(round_month, district_gpf, household_type) %>%
    summarize(median = median(cows, na.rm = TRUE)) %>%
    filter(!is.na(median))

df %>%
    kable(digits = 0,
          col.names = c("Round of Data Collection", "District", "Treatment/Control", 
                        "Median Number of Local Breed Cattle per Household"),
          caption = "Treatment and Control Groups at the First and Last Data Collection Rounds")

ggplot(df, aes(round_month, median, fill = household_type)) +
    geom_bar(stat = "identity", position = "dodge") +
    facet_wrap(~district_gpf) +
    labs(x = NULL, y = "Median Number of Local Breed Cattle per Household") +
    theme(legend.title=element_blank())

```

```{r, fig.width=7, fig.height=8}
df <- bind_rows(gpf_ppt %>% 
              filter(round_month == 'Jul 2014' & household_type == "Treatment") %>% 
              filter(cow_breed == 1) %>% 
              group_by(district_gpf, entry_id) %>% 
              summarize(cows = n()) %>% 
              mutate(deo_id = entry_id,
                     round_month = 'Jul 2014'),
          gpf_ppt %>% 
              filter(round_month %in% c('Dec 2014', 'Jul 2015','Dec 2015', 'Jul 2016') & household_type == "Treatment") %>% 
              filter(cow_breed == 1) %>% 
              group_by(round_month, district_gpf, deo_id) %>% 
              summarize(cows = n())) %>%
    ungroup %>%
    mutate(round_month = fct_relevel(round_month,
                              'Jul 2014',
                              'Dec 2014',
                              'Jul 2015',
                              'Dec 2015',
                              'Jul 2016')) %>%
    group_by(round_month, district_gpf) %>%
    summarize(median = median(cows, na.rm = TRUE)) %>%
    filter(!is.na(median))

df %>%
    kable(digits = 0,
          col.names = c("Round of Data Collection", "District", 
                        "Median Number of Local Breed Cattle per Household"),
          caption = "Treatment Group at All Data Collection Rounds")

ggplot(df, aes(round_month, median)) +
    geom_bar(stat = "identity") +
    facet_wrap(~ district_gpf) +
    labs(x = NULL, y = "Median Number of Local Breed Cattle per Household") +
    theme(axis.text.x= element_text(angle=45, hjust = 1))

```


## 3. Number of cross breed cattle per household, per district

```{r, fig.width=7, fig.height=7}
df <- bind_rows(gpf_ppt %>% 
              filter(round_month == 'Jul 2014') %>% 
              filter(cow_breed == 2) %>% 
              group_by(district_gpf, household_type, entry_id) %>% 
              summarize(cows = n()) %>% 
              mutate(deo_id = entry_id,
                     round_month = 'Jul 2014'),
          gpf_ppt %>% 
              filter(round_month == 'Jul 2016') %>% 
              filter(cow_breed == 2) %>% 
              group_by(district_gpf, household_type, deo_id) %>% 
              summarize(cows = n()) %>% 
              mutate(round_month = 'Jul 2016')) %>%
    group_by(round_month, district_gpf, household_type) %>%
    summarize(median = median(cows, na.rm = TRUE)) %>%
    filter(!is.na(median)) 
df %>%
    kable(digits = 0,
          col.names = c("Round of Data Collection", "District", "Treatment/Control", 
                        "Median Number of Cross Breed Cattle per Household"),
          caption = "Treatment and Control Groups at the First and Last Data Collection Rounds")

ggplot(df, aes(round_month, median, fill = household_type)) +
    geom_bar(stat = "identity", position = "dodge") +
    facet_wrap(~district_gpf) +
    labs(x = NULL, y = "Median Number of Cross Breed Cattle per Household") +
    theme(legend.title=element_blank())

```

```{r, fig.width=7, fig.height=8}
df <- bind_rows(gpf_ppt %>% 
              filter(round_month == 'Jul 2014' & household_type == "Treatment") %>% 
              filter(cow_breed == 1) %>% 
              group_by(district_gpf, entry_id) %>% 
              summarize(cows = n()) %>% 
              mutate(deo_id = entry_id,
                     round_month = 'Jul 2014'),
          gpf_ppt %>% 
              filter(round_month %in% c('Dec 2014', 'Jul 2015','Dec 2015', 'Jul 2016') & household_type == "Treatment") %>% 
              filter(cow_breed == 1) %>% 
              group_by(round_month, district_gpf, deo_id) %>% 
              summarize(cows = n())) %>%
    ungroup %>%
    mutate(round_month = fct_relevel(round_month,
                              'Jul 2014',
                              'Dec 2014',
                              'Jul 2015',
                              'Dec 2015',
                              'Jul 2016')) %>%
    group_by(round_month, district_gpf) %>%
    summarize(median = median(cows, na.rm = TRUE)) %>%
    filter(!is.na(median)) 
df %>%
    kable(digits = 0,
          col.names = c("Round of Data Collection", "District", 
                        "Median Number of Cross Breed Cows per Household"),
          caption = "Treatment Group at All Data Collection Rounds")

ggplot(df, aes(round_month, median)) +
    geom_bar(stat = "identity") +
    facet_wrap(~ district_gpf) +
    labs(x = NULL, y = "Median Number of Cross Breed Cattle per Household") +
    theme(axis.text.x= element_text(angle=45, hjust = 1))

```


## 4. Percentage of in-milking cows

DELETING

## 5. Average and Median Number of births per cow, per district

What does this one mean?

```{r}

```


## 6. Value of local breed and cross breed cows in BDT, by district

```{r, fig.width=7, fig.height=7}
df <- full_join(
    gpf_ppt %>% 
        filter(round_month %in% c('Jul 2014', 'Jul 2016')) %>%
        group_by(round_month, district_gpf, household_type) %>% 
        filter(cow_breed == 1) %>% 
        summarise(median1 = median(cow_value_bdt, na.rm = TRUE)), 
    gpf_ppt %>% 
        filter(round_month %in% c('Jul 2014', 'Jul 2016')) %>%
        group_by(round_month, district_gpf, household_type) %>% 
        filter(cow_breed == 2) %>% 
        summarise(median2 = median(cow_value_bdt, na.rm = TRUE))) 

df %>%
    kable(digits = 0,
          col.names = c("Round of Data Collection", "District", "Treatment/Control", 
                        "Median Value of Local Breed Cattle in BDT",
                        "Median Value of Cross Breed Cattle in BDT"),
          caption = "Treatment and Control Groups at the First and Last Data Collection Rounds")

ggplot(df, aes(round_month, median1, fill = household_type)) +
    geom_bar(stat = "identity", position = "dodge") +
    facet_wrap(~district_gpf) +
    labs(x = NULL, y = "Median Value of Local Breed Cattle in BDT") +
    theme(legend.title=element_blank())

ggplot(df, aes(round_month, median2, fill = household_type)) +
    geom_bar(stat = "identity", position = "dodge") +
    facet_wrap(~district_gpf) +
    labs(x = NULL, y = "Median Value of Cross Breed Cattle in BDT") +
    theme(legend.title=element_blank())

```

```{r, fig.width=7, fig.height=8}
df <- full_join(
    gpf_ppt %>% 
        filter(!is.na(round_month) & household_type == "Treatment") %>%
        group_by(round_month, district_gpf) %>% 
        filter(cow_breed == 1) %>% 
        summarise(`Local Breed` = median(cow_value_bdt, na.rm = TRUE)), 
    gpf_ppt %>% 
        filter(!is.na(round_month) & household_type == "Treatment") %>%
        group_by(round_month, district_gpf) %>% 
        filter(cow_breed == 2) %>% 
        summarise(`Cross Breed` = median(cow_value_bdt, na.rm = TRUE))) 

df %>%
    kable(digits = 0,
          col.names = c("Round of Data Collection", "District", 
                        "Median Value of Local Breed Cattle in BDT",
                        "Median Value of Cross Breed Cattle in BDT"),
          caption = "Treatment Group at All Data Collection Rounds")

ggplot(melt(df), aes(round_month, value, fill = variable)) +
    geom_bar(stat = "identity", position = "dodge") +
    facet_wrap(~ district_gpf) +
    labs(x = NULL, y = "Median Value of Cattle in BDT") +
    theme(legend.title=element_blank()) +
    theme(axis.text.x= element_text(angle=45, hjust = 1))

```

## 7. Productivity per in milk cow

```{r, fig.width=7, fig.height=7}
gpf_ppt$cow_daily_production[gpf_ppt$cow_daily_production == 0] <- NA

df <- gpf_ppt %>% 
    filter(round_month %in% c('Jul 2014', 'Jul 2016')) %>%
    group_by(round_month, district_gpf, household_type) %>% 
    summarise(median1 = median(cow_daily_production, na.rm = TRUE))

df %>%
    kable(digits = 1,
          col.names = c("Round of Data Collection", "District", "Treatment/Control", 
                        "Median Productivity per In-Milk Cow in Liters"),
          caption = "Treatment and Control Groups at the First and Last Data Collection Rounds")

ggplot(df, aes(round_month, median1, fill = household_type)) +
    geom_bar(stat = "identity", position = "dodge") +
    facet_wrap(~district_gpf) +
    labs(x = NULL, y = "Median Productivity per In-Milk Cow in Liters") +
    theme(legend.title=element_blank())
```

```{r, fig.width=7, fig.height=8}
df <- gpf_ppt %>% 
        filter(!is.na(round_month) & household_type == "Treatment") %>%
        group_by(round_month, district_gpf) %>% 
        summarise(median1 = median(cow_daily_production, na.rm = TRUE)) 

df %>%
    kable(digits = 0,
          col.names = c("Round of Data Collection", "District", 
                        "Median Productivity per In-Milk Cow in Liters"),
          caption = "Treatment Group at All Data Collection Rounds")

ggplot(df, aes(round_month, median1)) +
    geom_bar(stat = "identity") +
    facet_wrap(~ district_gpf) +
    labs(x = NULL, y = "Median Productivity per In-Milk Cow in Liters") +
    theme(axis.text.x= element_text(angle=45, hjust = 1))

```

## 8. Daily household production of cows in liters, by district

```{r, fig.width=7, fig.height=7}
df <- bind_rows(gpf_ppt %>% 
                    filter(round_month == 'Jul 2014') %>% 
                    group_by(district_gpf, household_type, entry_id) %>% 
                    summarize(cows = sum(cow_daily_production, na.rm = TRUE)) %>% 
                    mutate(deo_id = entry_id,
                           round_month = 'Jul 2014'),
                gpf_ppt %>% 
                    filter(round_month == 'Jul 2016') %>% 
                    group_by(district_gpf, household_type, deo_id) %>% 
                    summarize(cows = sum(cow_daily_production, na.rm = TRUE)) %>% 
                    mutate(round_month = 'Jul 2016')) %>%
    group_by(round_month, district_gpf, household_type) %>%
    summarize(median1 = median(cows, na.rm = TRUE)) 

df %>%
    kable(digits = 0,
          col.names = c("Round of Data Collection", "District", "Treatment/Control", 
                        "Median Daily Household Milk Production in Liters"),
          caption = "Treatment and Control Groups at the First and Last Data Collection Rounds")


ggplot(df, aes(round_month, median1, fill = household_type)) +
    geom_bar(stat = "identity", position = "dodge") +
    facet_wrap(~district_gpf) +
    labs(x = NULL, y = "Median Daily Household Milk Production in Liters") +
    theme(legend.title=element_blank())

```

As you can see, there are a lot of households that have zero production (zero daily production or `NA` recorded for all of their cows). Should I remove the zeroes/`NA` values before taking the median?

```{r, fig.width=7, fig.height=8}
df <- bind_rows(gpf_ppt %>% 
                    filter(round_month == 'Jul 2014' & household_type == "Treatment") %>% 
                    group_by(district_gpf, entry_id) %>% 
                    summarize(cows = sum(cow_daily_production, na.rm = TRUE)) %>% 
                    mutate(deo_id = entry_id,
                           round_month = 'Jul 2014'),
                gpf_ppt %>% 
                    filter(round_month %in% c('Dec 2014', 'Jul 2015','Dec 2015', 'Jul 2016') & household_type == "Treatment") %>% 
                    group_by(round_month, district_gpf, deo_id) %>% 
                    summarize(cows = sum(cow_daily_production, na.rm = TRUE))) %>%
    ungroup %>%
    mutate(round_month = fct_relevel(round_month,
                              'Jul 2014',
                              'Dec 2014',
                              'Jul 2015',
                              'Dec 2015',
                              'Jul 2016')) %>%
    group_by(round_month, district_gpf) %>%
    summarize(median1 = median(cows, na.rm = TRUE)) 

df %>%
    kable(digits = 0,
          col.names = c("Round of Data Collection", "District",
                        "Median Daily Household Milk Production in Liters"),
          caption = "Treatment Group at All Data Collection Rounds")

ggplot(df, aes(round_month, median1)) +
    geom_bar(stat = "identity") +
    facet_wrap(~ district_gpf) +
    labs(x = NULL, y = "Median Productivity per In-Milk Cow in Liters") +
    theme(axis.text.x= element_text(angle=45, hjust = 1))

```

## 9. Value of Herd

```{r, fig.width=7, fig.height=6}
df <- bind_rows(gpf_ppt %>% 
              filter(round_month == 'Jul 2014') %>% 
              group_by(household_type, entry_id) %>% 
              summarize(cows = sum(cow_value_bdt, na.rm = TRUE)) %>% 
              mutate(deo_id = entry_id,
                     round_month = 'Jul 2014'),
          gpf_ppt %>% 
              filter(round_month == 'Jul 2016') %>% 
              group_by(household_type, deo_id) %>% 
              summarize(cows = sum(cow_value_bdt, na.rm = TRUE)) %>% 
              mutate(round_month = 'Jul 2016')) %>%
    group_by(round_month, household_type) %>%
    summarize(median = median(cows, na.rm = TRUE)) 

df %>%
    kable(digits = 0,
          col.names = c("Round of Data Collection", "Treatment/Control", 
                        "Median Value of Herd in BDT"),
          caption = "Treatment and Control Groups at the First and Last Data Collection Rounds")

ggplot(df, aes(round_month, median, fill = household_type)) +
    geom_bar(stat = "identity", position = "dodge") +
    labs(x = NULL, y = "Median Value of Herd in BDT") +
    theme(legend.title=element_blank())

```

```{r, fig.width=7, fig.height=6}
df <- bind_rows(gpf_ppt %>% 
              filter(round_month == 'Jul 2014' & household_type == "Treatment") %>% 
              group_by(entry_id) %>% 
              summarize(cows = sum(cow_value_bdt, na.rm = TRUE)) %>% 
              mutate(deo_id = entry_id,
                     round_month = 'Jul 2014'),
          gpf_ppt %>% 
              filter(round_month %in% c('Dec 2014', 'Jul 2015','Dec 2015', 'Jul 2016') & household_type == "Treatment") %>% 
              group_by(round_month, deo_id) %>% 
              summarize(cows = sum(cow_value_bdt, na.rm = TRUE))) %>%
    ungroup %>%
    mutate(round_month = fct_relevel(round_month,
                              'Jul 2014',
                              'Dec 2014',
                              'Jul 2015',
                              'Dec 2015',
                              'Jul 2016')) %>%
    group_by(round_month) %>%
    summarize(median = median(cows, na.rm = TRUE)) 

df %>%
    kable(digits = 0,
          col.names = c("Round of Data Collection", 
                        "Median Value of Herd in BDT"),
          caption = "Treatment Group at All Data Collection Rounds")

ggplot(df, aes(round_month, median)) +
    geom_bar(stat = "identity") +
    labs(x = NULL, y = "Median Productivity of Herd in Liters")
```


## 10. Productivity of Herd

```{r, fig.width=8, fig.height=6}
gpf_ppt$cow_daily_production[gpf_ppt$cow_daily_production == 0] <- NA

df <- bind_rows(gpf_ppt %>% 
              filter(round_month == 'Jul 2014') %>% 
              group_by(household_type, entry_id) %>% 
              summarize(cows = sum(cow_daily_production)) %>% 
              mutate(deo_id = entry_id,
                     round_month = 'Jul 2014'),
          gpf_ppt %>% 
              filter(round_month == 'Jul 2016') %>% 
              group_by(household_type, deo_id) %>% 
              summarize(cows = sum(cow_daily_production)) %>% 
              mutate(round_month = 'Jul 2016')) %>%
    group_by(round_month, household_type) %>%
    summarize(median = median(cows, na.rm = TRUE))

df %>%
    kable(digits = 1,
          col.names = c("Round of Data Collection", "Treatment/Control", 
                        "Median Productivity of Herd in Liters"),
          caption = "Treatment and Control Groups at the First and Last Data Collection Rounds")


ggplot(df, aes(round_month, median, fill = household_type)) +
    geom_bar(stat = "identity", position = "dodge") +
    labs(x = NULL, y = "Median Productivity of Herd in Liters") +
    theme(legend.title=element_blank())
```

```{r,  fig.width=8, fig.height=6}
df <- bind_rows(gpf_ppt %>% 
              filter(round_month == 'Jul 2014' & household_type == "Treatment") %>% 
              group_by(entry_id) %>% 
              summarize(cows = sum(cow_daily_production)) %>% 
              mutate(deo_id = entry_id,
                     round_month = 'Jul 2014'),
          gpf_ppt %>% 
              filter(round_month %in% c('Dec 2014', 'Jul 2015','Dec 2015', 'Jul 2016') & household_type == "Treatment") %>% 
              group_by(round_month, deo_id) %>% 
              summarize(cows = sum(cow_daily_production))) %>%
    ungroup %>%
    mutate(round_month = fct_relevel(round_month,
                              'Jul 2014',
                              'Dec 2014',
                              'Jul 2015',
                              'Dec 2015',
                              'Jul 2016')) %>%
    group_by(round_month) %>%
    summarize(median = median(cows, na.rm = TRUE))

df %>%
    kable(digits = 1,
          col.names = c("Round of Data Collection", 
                        "Median Productivity of Herd in Liters"),
          caption = "Treatment Group at All Data Collection Rounds")

ggplot(df, aes(round_month, median)) +
    geom_bar(stat = "identity") +
    labs(x = NULL, y = "Median Productivity of Herd in Liters")

```


## Make a Producers Data Frame

```{r}
producers <- bind_rows(gpf_ppt %>% 
                           filter(round_month == 'Jul 2014') %>% 
                           distinct(entry_id, .keep_all = TRUE),
                       gpf_ppt %>%
                           filter(round_month != 'Jul 2014') %>%
                           distinct(household_type, deo_id, round, .keep_all = TRUE))
                    
dim(producers)    
```




## 11. Total Income from Milk Sales (Tk.) per day

```{r, fig.width=8, fig.height=6}

df <- producers %>%
    filter(round_month %in% c('Jul 2014', 'Jul 2016')) %>%
    group_by(round_month, household_type) %>%
    summarize(median1 = median(yesterday_total_income_from_milk_sale, na.rm = TRUE))
    
df %>%
    kable(digits = 0,
          col.names = c("Round of Data Collection", "Treatment/Control", 
                        "Median Daily Income from Milk Sales in Taka"),
          caption = "Treatment and Control Groups at the First and Last Data Collection Rounds")

ggplot(df, aes(round_month, median1, fill = household_type)) +
    geom_bar(stat = "identity", position = "dodge") +
    labs(x = NULL, y = "Median Daily Income from Milk Sales in Taka") +
    theme(legend.title=element_blank())
```

```{r, fig.width=8, fig.height=6}
df <- producers %>% 
    filter(household_type == "Treatment") %>% 
    group_by(round_month) %>% 
    summarize(median1 = median(yesterday_total_income_from_milk_sale, na.rm = TRUE))
 
df %>%
    kable(digits = 0,
          col.names = c("Round of Data Collection", 
                        "Median Daily Income from Milk Sales in Taka"),
          caption = "Treatment Group at All Data Collection Rounds")

ggplot(df, aes(round_month, median1)) +
    geom_bar(stat = "identity") +
    labs(x = NULL, y = "Median Daily Income from Milk Sales in Taka")
```

## 12. Total Milk Consumption in Liters

```{r, eval=FALSE}
gpf_ppt <- gpf_ppt %>%
    mutate(total_consumption_ltr = as.numeric(total_consumption_ltr))

gpf_ppt %>% 
    filter(round_month %in% c('Jul 2014', 'Jul 2016')) %>%
    group_by(round_month, household_type) %>%
    summarise(avg1 = mean(total_consumption_ltr, na.rm = TRUE),
              median1 = median(total_consumption_ltr, na.rm = TRUE)) %>%
    kable(digits = 2,
          col.names = c("Round of Data Collection", "Treatment/Control", 
                        "Total Milk Consumption in Liters (Average)", "Total Milk Consumption in Liters (Median)"),
          caption = "Treatment and Control Groups at the First and Last Data Collection Rounds")

```

```{r, eval=FALSE}
gpf_ppt %>% 
    filter(!is.na(round_month) & household_type == "Treatment") %>%
    group_by(round_month) %>%
    summarise(avg1 = mean(total_consumption_ltr, na.rm = TRUE),
              median1 = median(total_consumption_ltr, na.rm = TRUE)) %>%
    kable(digits = 0,
          col.names = c("Round of Data Collection", 
                        "Total Milk Consumption in Liters (Average)", "Total Milk Consumption in Liters (Median)"),
          caption = "Treatment Group at All Data Collection Rounds")
```


## 13. Milk Consumption Priorities (proportions/percentages)



## 14. Milk Distribution Patterns – litres

```{r, eval=FALSE}
gpf_ppt <- gpf_ppt %>%
    mutate(total_free_distribution_ltr = as.numeric(total_free_distribution_ltr),
           neighbors = as.numeric(neighbors),
           neighbours = as.numeric(neighbours),
           collection_point = as.numeric(collection_point),
           milk_collector = as.numeric(milk_collector),
           open_market = as.numeric(open_market),
           sweetmeat_tea_stall = as.numeric(sweetmeat_tea_stall),
           direct_to_company = as.numeric(direct_to_company),
           yesterday_total_spoilage_ltr = as.numeric(yesterday_total_spoilage_ltr))

## maybe turn zeroes to NAs first?

gpf_ppt %>% 
    filter(round_month %in% c('Jul 2014', 'Jul 2016')) %>%
    group_by(round_month, household_type) %>%
    summarise(free = median(total_free_distribution_ltr, na.rm = TRUE),
              neighbors = sum(median(neighbours, na.rm = TRUE), mean(neighbors, na.rm = TRUE), na.rm = TRUE),
              collection_point = median(collection_point, na.rm = TRUE),
              milk_collector = median(milk_collector, na.rm = TRUE),
              open_market = median(open_market, na.rm = TRUE),
              sweetmeat_tea_stall = median(sweetmeat_tea_stall, na.rm = TRUE),
              direct_to_company = median(direct_to_company, na.rm = TRUE),
              yesterday = median(yesterday_total_spoilage_ltr, na.rm = TRUE)) %>%
    kable(digits = 1,
          col.names = c("Round of Data Collection", "Treatment/Control", 
                        "Milk Given Away for Free (Liters)", "Milk Sold to Neighbors (Liters)",
                        "Milk Sold at Collection Point (Liters)", "Milk Sold to Milk Collector (Liters)",
                        "Milk Sold at Open Market (Liters)", "Milk Sold at Tea Stall (Liters)",
                        "Milk Sold Directly to Company (Liters)", "Milk Spoiled (Liters)"),
          caption = "Treatment and Control Groups at the First and Last Data Collection Rounds")

```

```{r, eval=FALSE}
gpf_ppt %>% 
    filter(!is.na(round_month) & household_type == "Treatment") %>%
    group_by(round_month) %>%
    summarise(free = median(total_free_distribution_ltr, na.rm = TRUE),
              neighbors = sum(median(neighbours, na.rm = TRUE), mean(neighbors, na.rm = TRUE), na.rm = TRUE),
              collection_point = median(collection_point, na.rm = TRUE),
              milk_collector = median(milk_collector, na.rm = TRUE),
              open_market = median(open_market, na.rm = TRUE),
              sweetmeat_tea_stall = median(sweetmeat_tea_stall, na.rm = TRUE),
              direct_to_company = median(direct_to_company, na.rm = TRUE),
              yesterday = median(yesterday_total_spoilage_ltr, na.rm = TRUE)) %>%
    kable(digits = 1,
          col.names = c("Round of Data Collection", 
                        "Milk Given Away for Free (Liters)", "Milk Sold to Neighbors (Liters)",
                        "Milk Sold at Collection Point (Liters)", "Milk Sold to Milk Collector (Liters)",
                        "Milk Sold at Open Market (Liters)", "Milk Sold at Tea Stall (Liters)",
                        "Milk Sold Directly to Company (Liters)", "Milk Spoiled (Liters)"),
          caption = "Treatment Group at All Data Collection Rounds")
```


## 15. Milk Distribution Patterns – percentages

```{r, eval=FALSE}
gpf_ppt <- gpf_ppt %>%
    rowwise() %>%
    mutate(total_distribution = sum(total_free_distribution_ltr,
                                    neighbors, 
                                    neighbours,
                                    collection_point,
                                    milk_collector,
                                    open_market,
                                    sweetmeat_tea_stall,
                                    direct_to_company,
                                    yesterday_total_spoilage_ltr,
                                    na.rm = TRUE)) %>%
    ungroup()

gpf_ppt %>% 
    filter(round_month %in% c('Jul 2014', 'Jul 2016')) %>%
    group_by(round_month, household_type) %>%
    summarise(free = median(total_free_distribution_ltr/total_distribution, na.rm = TRUE),
              neighbors = sum(median(neighbours/total_distribution, na.rm = TRUE), 
                              mean(neighbors/total_distribution, na.rm = TRUE), na.rm = TRUE),
              collection_point = median(collection_point/total_distribution, na.rm = TRUE),
              milk_collector = median(milk_collector/total_distribution, na.rm = TRUE),
              open_market = median(open_market/total_distribution, na.rm = TRUE),
              sweetmeat_tea_stall = median(sweetmeat_tea_stall/total_distribution, na.rm = TRUE),
              direct_to_company = median(direct_to_company/total_distribution, na.rm = TRUE),
              yesterday = median(yesterday_total_spoilage_ltr/total_distribution, na.rm = TRUE)) %>%
    kable(digits = 1,
          col.names = c("Round of Data Collection", "Treatment/Control", 
                        "Milk Given Away for Free (Liters)", "Milk Sold to Neighbors (Liters)",
                        "Milk Sold at Collection Point (Liters)", "Milk Sold to Milk Collector (Liters)",
                        "Milk Sold at Open Market (Liters)", "Milk Sold at Tea Stall (Liters)",
                        "Milk Sold Directly to Company (Liters)", "Milk Spoiled (Liters)"),
          caption = "Treatment and Control Groups at the First and Last Data Collection Rounds")

```



## 16. Market Linkage Choices (proportions)
