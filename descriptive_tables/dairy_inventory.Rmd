---
title: "SDVC Final Report Descriptive Tables"
subtitle: "Dairy Cattle Inventory and Milk Production"
author: "Julia Silge"
date: "`r Sys.Date()`"
output: html_document
---

```{r, echo = FALSE, warning = FALSE}
library(knitr)
knitr::opts_chunk$set(cache = TRUE, warning = FALSE, message = FALSE, dpi = 180)
options(width=80, dplyr.width = 150)
```

Before we make some pretty tables, let's read in the data.

```{r}
library(readr)
library(forcats)
library(dplyr)
gpf_ppt <- read_csv("../data/gpf_ppt_merged.csv", 
                    col_types = cols(.default = col_character()))
dim(gpf_ppt)

gpf_ppt <- gpf_ppt %>%
    mutate(round = fct_recode(round,
                              `Jul 2014` = '1.0',
                              `Dec 2014` = '2.0',
                              `Jul 2015` = '3.0',
                              `Dec 2015` = '4.0',
                              `Jul 2016` = '5.0')) %>%
    mutate(household_type = fct_collapse(household_type,
                                         Treatment = c("1", "2", "3"),
                                         Control = c("4", "5", "6")))

gpf_ppt[,c(273:275)] <- lapply(gpf_ppt[,c(273:275)], as.numeric)
gpf_ppt$district_gpf[gpf_ppt$district_gpf == "pabna"] <- "Pabna"
```

## 1. Cattle inventory by household, by district

```{r}
bind_rows(gpf_ppt %>% 
              filter(round == 'Jul 2014') %>% 
              group_by(district_gpf, household_type, entry_id) %>% 
              summarize(cows = n()) %>% 
              mutate(deo_id = entry_id,
                     round = 'Jul 2014'),
          gpf_ppt %>% 
              filter(round == 'Jul 2016') %>% 
              group_by(district_gpf, household_type, deo_id) %>% 
              summarize(cows = n()) %>% 
              mutate(round = 'Jul 2016')) %>%
    group_by(round, district_gpf, household_type) %>%
    summarize(mean = mean(cows, na.rm = TRUE),
              median = median(cows, na.rm = TRUE)) %>%
    filter(!is.na(median)) %>%
    kable(digits = 0,
          col.names = c("Round of Data Collection", "District", "Treatment/Control",
                        "Number of Cattle per Household (Average)", "Number of Cattle per Household (Median)"),
          caption = "Treatment and Control Groups at the First and Last Data Collection Rounds")

```

```{r}
bind_rows(gpf_ppt %>% 
              filter(round == 'Jul 2014' & household_type == "Treatment") %>% 
              group_by(district_gpf, entry_id) %>% 
              summarize(cows = n()) %>% 
              mutate(deo_id = entry_id,
                     round = 'Jul 2014'),
          gpf_ppt %>% 
              filter(round %in% c('Dec 2014', 'Jul 2015','Dec 2015', 'Jul 2016') & household_type == "Treatment") %>% 
              group_by(round, district_gpf, deo_id) %>% 
              summarize(cows = n())) %>%
    ungroup %>%
    mutate(round = fct_relevel(round,
                              'Jul 2014',
                              'Dec 2014',
                              'Jul 2015',
                              'Dec 2015',
                              'Jul 2016')) %>%
    group_by(round, district_gpf) %>%
    summarize(mean = mean(cows, na.rm = TRUE),
              median = median(cows, na.rm = TRUE)) %>%
    filter(!is.na(median)) %>%
    kable(digits = 0,
          col.names = c("Round of Data Collection", "District", 
                        "Number of Cattle per Household (Average)", "Number of Cattle per Household (Median)"),
          caption = "Treatment Group at All Data Collection Rounds")
```

## 2. Number of local breed cattle per household, per district

```{r}
bind_rows(gpf_ppt %>% 
              filter(round == 'Jul 2014') %>% 
              filter(cow_breed == 1) %>% 
              group_by(district_gpf, household_type, entry_id) %>% 
              summarize(cows = n()) %>% 
              mutate(deo_id = entry_id,
                     round = 'Jul 2014'),
          gpf_ppt %>% 
              filter(round == 'Jul 2016') %>% 
              filter(cow_breed == 1) %>% 
              group_by(district_gpf, household_type, deo_id) %>% 
              summarize(cows = n()) %>% 
              mutate(round = 'Jul 2016')) %>%
    group_by(round, district_gpf, household_type) %>%
    summarize(mean = mean(cows, na.rm = TRUE),
              median = median(cows, na.rm = TRUE)) %>%
    filter(!is.na(median)) %>%
    kable(digits = 0,
          col.names = c("Round of Data Collection", "District", "Treatment/Control", 
                        "Number of Local Breed Cattle per Household (Average)", "Number of Local Breed Cattle per Household (Median)"),
          caption = "Treatment and Control Groups at the First and Last Data Collection Rounds")

```

```{r}
bind_rows(gpf_ppt %>% 
              filter(round == 'Jul 2014' & household_type == "Treatment") %>% 
              filter(cow_breed == 1) %>% 
              group_by(district_gpf, entry_id) %>% 
              summarize(cows = n()) %>% 
              mutate(deo_id = entry_id,
                     round = 'Jul 2014'),
          gpf_ppt %>% 
              filter(round %in% c('Dec 2014', 'Jul 2015','Dec 2015', 'Jul 2016') & household_type == "Treatment") %>% 
              filter(cow_breed == 1) %>% 
              group_by(round, district_gpf, deo_id) %>% 
              summarize(cows = n())) %>%
    ungroup %>%
    mutate(round = fct_relevel(round,
                              'Jul 2014',
                              'Dec 2014',
                              'Jul 2015',
                              'Dec 2015',
                              'Jul 2016')) %>%
    group_by(round, district_gpf) %>%
    summarize(mean = mean(cows, na.rm = TRUE),
              median = median(cows, na.rm = TRUE)) %>%
    filter(!is.na(median)) %>%
    kable(digits = 0,
          col.names = c("Round of Data Collection", "District", 
                        "Number of Local Breed Cows per Household (Average)", "Number of Local Breed Cows per Household (Median)"),
          caption = "Treatment Group at All Data Collection Rounds")
```


## 3. Number of cross breed cattle per household, per district

```{r}
bind_rows(gpf_ppt %>% 
              filter(round == 'Jul 2014') %>% 
              filter(cow_breed == 2) %>% 
              group_by(district_gpf, household_type, entry_id) %>% 
              summarize(cows = n()) %>% 
              mutate(deo_id = entry_id,
                     round = 'Jul 2014'),
          gpf_ppt %>% 
              filter(round == 'Jul 2016') %>% 
              filter(cow_breed == 2) %>% 
              group_by(district_gpf, household_type, deo_id) %>% 
              summarize(cows = n()) %>% 
              mutate(round = 'Jul 2016')) %>%
    group_by(round, district_gpf, household_type) %>%
    summarize(mean = mean(cows, na.rm = TRUE),
              median = median(cows, na.rm = TRUE)) %>%
    filter(!is.na(median)) %>%
    kable(digits = 0,
          col.names = c("Round of Data Collection", "District", "Treatment/Control", 
                        "Number of Cross Breed Cattle per Household (Average)", "Number of Cross Breed Cattle per Household (Median)"),
          caption = "Treatment and Control Groups at the First and Last Data Collection Rounds")

```

```{r}
bind_rows(gpf_ppt %>% 
              filter(round == 'Jul 2014' & household_type == "Treatment") %>% 
              filter(cow_breed == 1) %>% 
              group_by(district_gpf, entry_id) %>% 
              summarize(cows = n()) %>% 
              mutate(deo_id = entry_id,
                     round = 'Jul 2014'),
          gpf_ppt %>% 
              filter(round %in% c('Dec 2014', 'Jul 2015','Dec 2015', 'Jul 2016') & household_type == "Treatment") %>% 
              filter(cow_breed == 1) %>% 
              group_by(round, district_gpf, deo_id) %>% 
              summarize(cows = n())) %>%
    ungroup %>%
    mutate(round = fct_relevel(round,
                              'Jul 2014',
                              'Dec 2014',
                              'Jul 2015',
                              'Dec 2015',
                              'Jul 2016')) %>%
    group_by(round, district_gpf) %>%
    summarize(mean = mean(cows, na.rm = TRUE),
              median = median(cows, na.rm = TRUE)) %>%
    filter(!is.na(median)) %>%
    kable(digits = 0,
          col.names = c("Round of Data Collection", "District", 
                        "Number of Cross Breed Cows per Household (Average)", "Number of Cross Breed Cows per Household (Median)"),
          caption = "Treatment Group at All Data Collection Rounds")
```


## 4. Percentage of in-milking cows

DELETING

## Number of births per cow, per district

## 6. Value of local breed and cross breed cows in BDT, by district

```{r}
full_join(
    gpf_ppt %>% 
        filter(round %in% c('Jul 2014', 'Jul 2016')) %>%
        group_by(round, district_gpf, household_type) %>% 
        filter(cow_breed == 1) %>% 
        summarise(median1 = median(cow_value_bdt, na.rm = TRUE)), 
    gpf_ppt %>% 
        filter(round %in% c('Jul 2014', 'Jul 2016')) %>%
        group_by(round, district_gpf, household_type) %>% 
        filter(cow_breed == 2) %>% 
        summarise(median2 = median(cow_value_bdt, na.rm = TRUE))) %>%
    kable(digits = 0,
          col.names = c("Round of Data Collection", "District", "Treatment/Control", 
                        "Median Value of Local Breed Cattle in BDT",
                        "Median Value of Cross Breed Cattle in BDT"),
          caption = "Treatment and Control Groups at the First and Last Data Collection Rounds")

```

```{r}
full_join(
    gpf_ppt %>% 
        filter(!is.na(round) & household_type == "Treatment") %>%
        group_by(round, district_gpf) %>% 
        filter(cow_breed == 1) %>% 
        summarise(median1 = median(cow_value_bdt, na.rm = TRUE)), 
    gpf_ppt %>% 
        filter(!is.na(round) & household_type == "Treatment") %>%
        group_by(round, district_gpf) %>% 
        filter(cow_breed == 2) %>% 
        summarise(median2 = median(cow_value_bdt, na.rm = TRUE))) %>%
    kable(digits = 0,
          col.names = c("Round of Data Collection", "District", 
                        "Median Value of Local Breed Cattle in BDT",
                        "Median Value of Cross Breed Cattle in BDT"),
          caption = "Treatment Group at All Data Collection Rounds")
```



## 9. Value of Herd

```{r}
bind_rows(gpf_ppt %>% 
              filter(round == 'Jul 2014') %>% 
              group_by(household_type, entry_id) %>% 
              summarize(cows = sum(cow_value_bdt)) %>% 
              mutate(deo_id = entry_id,
                     round = 'Jul 2014'),
          gpf_ppt %>% 
              filter(round == 'Jul 2016') %>% 
              group_by(household_type, deo_id) %>% 
              summarize(cows = sum(cow_value_bdt)) %>% 
              mutate(round = 'Jul 2016')) %>%
    group_by(round, household_type) %>%
    summarize(median = median(cows, na.rm = TRUE)) %>%
    kable(digits = 0,
          col.names = c("Round of Data Collection", "Treatment/Control", 
                        "Median Value of Herd in BDT"),
          caption = "Treatment and Control Groups at the First and Last Data Collection Rounds")

```

```{r}
bind_rows(gpf_ppt %>% 
              filter(round == 'Jul 2014' & household_type == "Treatment") %>% 
              group_by(entry_id) %>% 
              summarize(cows = sum(cow_value_bdt)) %>% 
              mutate(deo_id = entry_id,
                     round = 'Jul 2014'),
          gpf_ppt %>% 
              filter(round %in% c('Dec 2014', 'Jul 2015','Dec 2015', 'Jul 2016') & household_type == "Treatment") %>% 
              group_by(round, deo_id) %>% 
              summarize(cows = sum(cow_value_bdt))) %>%
    ungroup %>%
    mutate(round = fct_relevel(round,
                              'Jul 2014',
                              'Dec 2014',
                              'Jul 2015',
                              'Dec 2015',
                              'Jul 2016')) %>%
    group_by(round) %>%
    summarize(median = median(cows, na.rm = TRUE)) %>%
    kable(digits = 0,
          col.names = c("Round of Data Collection", 
                        "Median Value of Herd in BDT"),
          caption = "Treatment Group at All Data Collection Rounds")
```




## Productivity of Herd

## Daily household production of cows in liters, by district, by breed

## 11. Total Income from Milk Sales (Tk.) per day

```{r, eval=FALSE}
gpf_ppt <- gpf_ppt %>%
    mutate(yesterday_total_income_from_milk_sale = as.numeric(yesterday_total_income_from_milk_sale))

gpf_ppt %>% 
    filter(round %in% c('Jul 2014', 'Jul 2016')) %>%
    group_by(round, household_type) %>%
    summarise(avg1 = 30 * mean(yesterday_total_income_from_milk_sale, na.rm = TRUE),
              median1 = 30 * median(yesterday_total_income_from_milk_sale, na.rm = TRUE)) %>%
    kable(digits = 0,
          col.names = c("Round of Data Collection", "Treatment/Control", 
                        "Total Monthly Income from Milk Sales in Taka (Average)", 
                        "Total Monthly Income from Milk Sales in Taka (Median)"),
          caption = "Treatment and Control Groups at the First and Last Data Collection Rounds")

```

```{r, eval=FALSE}
gpf_ppt %>% 
    filter(!is.na(round) & household_type == "Treatment") %>%
    group_by(round) %>%
    summarise(avg1 = 30 * mean(yesterday_total_income_from_milk_sale, na.rm = TRUE),
              median1 = 30 * median(yesterday_total_income_from_milk_sale, na.rm = TRUE)) %>%
    kable(digits = 0,
          col.names = c("Round of Data Collection", 
                        "Total Monthly Income from Milk Sales in Taka (Average)", 
                        "Total Monthly Income from Milk Sales in Taka (Median)"),
          caption = "Treatment Group at All Data Collection Rounds")
```





## Total Milk Consumption in Liters

```{r, eval=FALSE}
gpf_ppt <- gpf_ppt %>%
    mutate(total_consumption_ltr = as.numeric(total_consumption_ltr))

gpf_ppt %>% 
    filter(round %in% c('Jul 2014', 'Jul 2016')) %>%
    group_by(round, household_type) %>%
    summarise(avg1 = mean(total_consumption_ltr, na.rm = TRUE),
              median1 = median(total_consumption_ltr, na.rm = TRUE)) %>%
    kable(digits = 2,
          col.names = c("Round of Data Collection", "Treatment/Control", 
                        "Total Milk Consumption in Liters (Average)", "Total Milk Consumption in Liters (Median)"),
          caption = "Treatment and Control Groups at the First and Last Data Collection Rounds")

```

```{r, eval=FALSE}
gpf_ppt %>% 
    filter(!is.na(round) & household_type == "Treatment") %>%
    group_by(round) %>%
    summarise(avg1 = mean(total_consumption_ltr, na.rm = TRUE),
              median1 = median(total_consumption_ltr, na.rm = TRUE)) %>%
    kable(digits = 0,
          col.names = c("Round of Data Collection", 
                        "Total Milk Consumption in Liters (Average)", "Total Milk Consumption in Liters (Median)"),
          caption = "Treatment Group at All Data Collection Rounds")
```


## Milk Consumption Priorities



## Milk Distribution Patterns – litres

```{r, eval=FALSE}
gpf_ppt <- gpf_ppt %>%
    mutate(total_free_distribution_ltr = as.numeric(total_free_distribution_ltr),
           neighbors = as.numeric(neighbors),
           neighbours = as.numeric(neighbours),
           collection_point = as.numeric(collection_point),
           milk_collector = as.numeric(milk_collector),
           open_market = as.numeric(open_market),
           sweetmeat_tea_stall = as.numeric(sweetmeat_tea_stall),
           direct_to_company = as.numeric(direct_to_company),
           yesterday_total_spoilage_ltr = as.numeric(yesterday_total_spoilage_ltr))

## maybe turn zeroes to NAs first?

gpf_ppt %>% 
    filter(round %in% c('Jul 2014', 'Jul 2016')) %>%
    group_by(round, household_type) %>%
    summarise(free = median(total_free_distribution_ltr, na.rm = TRUE),
              neighbors = sum(median(neighbours, na.rm = TRUE), mean(neighbors, na.rm = TRUE), na.rm = TRUE),
              collection_point = median(collection_point, na.rm = TRUE),
              milk_collector = median(milk_collector, na.rm = TRUE),
              open_market = median(open_market, na.rm = TRUE),
              sweetmeat_tea_stall = median(sweetmeat_tea_stall, na.rm = TRUE),
              direct_to_company = median(direct_to_company, na.rm = TRUE),
              yesterday = median(yesterday_total_spoilage_ltr, na.rm = TRUE)) %>%
    kable(digits = 1,
          col.names = c("Round of Data Collection", "Treatment/Control", 
                        "Milk Given Away for Free (Liters)", "Milk Sold to Neighbors (Liters)",
                        "Milk Sold at Collection Point (Liters)", "Milk Sold to Milk Collector (Liters)",
                        "Milk Sold at Open Market (Liters)", "Milk Sold at Tea Stall (Liters)",
                        "Milk Sold Directly to Company (Liters)", "Milk Spoiled (Liters)"),
          caption = "Treatment and Control Groups at the First and Last Data Collection Rounds")

```

```{r, eval=FALSE}
gpf_ppt %>% 
    filter(!is.na(round) & household_type == "Treatment") %>%
    group_by(round) %>%
    summarise(free = median(total_free_distribution_ltr, na.rm = TRUE),
              neighbors = sum(median(neighbours, na.rm = TRUE), mean(neighbors, na.rm = TRUE), na.rm = TRUE),
              collection_point = median(collection_point, na.rm = TRUE),
              milk_collector = median(milk_collector, na.rm = TRUE),
              open_market = median(open_market, na.rm = TRUE),
              sweetmeat_tea_stall = median(sweetmeat_tea_stall, na.rm = TRUE),
              direct_to_company = median(direct_to_company, na.rm = TRUE),
              yesterday = median(yesterday_total_spoilage_ltr, na.rm = TRUE)) %>%
    kable(digits = 1,
          col.names = c("Round of Data Collection", 
                        "Milk Given Away for Free (Liters)", "Milk Sold to Neighbors (Liters)",
                        "Milk Sold at Collection Point (Liters)", "Milk Sold to Milk Collector (Liters)",
                        "Milk Sold at Open Market (Liters)", "Milk Sold at Tea Stall (Liters)",
                        "Milk Sold Directly to Company (Liters)", "Milk Spoiled (Liters)"),
          caption = "Treatment Group at All Data Collection Rounds")
```


## Milk Distribution Patterns – percentages

```{r, eval=FALSE}
gpf_ppt <- gpf_ppt %>%
    rowwise() %>%
    mutate(total_distribution = sum(total_free_distribution_ltr,
                                    neighbors, 
                                    neighbours,
                                    collection_point,
                                    milk_collector,
                                    open_market,
                                    sweetmeat_tea_stall,
                                    direct_to_company,
                                    yesterday_total_spoilage_ltr,
                                    na.rm = TRUE)) %>%
    ungroup()

gpf_ppt %>% 
    filter(round %in% c('Jul 2014', 'Jul 2016')) %>%
    group_by(round, household_type) %>%
    summarise(free = median(total_free_distribution_ltr/total_distribution, na.rm = TRUE),
              neighbors = sum(median(neighbours/total_distribution, na.rm = TRUE), 
                              mean(neighbors/total_distribution, na.rm = TRUE), na.rm = TRUE),
              collection_point = median(collection_point/total_distribution, na.rm = TRUE),
              milk_collector = median(milk_collector/total_distribution, na.rm = TRUE),
              open_market = median(open_market/total_distribution, na.rm = TRUE),
              sweetmeat_tea_stall = median(sweetmeat_tea_stall/total_distribution, na.rm = TRUE),
              direct_to_company = median(direct_to_company/total_distribution, na.rm = TRUE),
              yesterday = median(yesterday_total_spoilage_ltr/total_distribution, na.rm = TRUE)) %>%
    kable(digits = 1,
          col.names = c("Round of Data Collection", "Treatment/Control", 
                        "Milk Given Away for Free (Liters)", "Milk Sold to Neighbors (Liters)",
                        "Milk Sold at Collection Point (Liters)", "Milk Sold to Milk Collector (Liters)",
                        "Milk Sold at Open Market (Liters)", "Milk Sold at Tea Stall (Liters)",
                        "Milk Sold Directly to Company (Liters)", "Milk Spoiled (Liters)"),
          caption = "Treatment and Control Groups at the First and Last Data Collection Rounds")

```



## Market Linkage Choices
