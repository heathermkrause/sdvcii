---
title: "SDVC Final Report Descriptive Tables"
subtitle: "Dairy Practices : Knowledge and Practice of Cow Rearing"
author: "Julia Silge"
date: "`r Sys.Date()`"
output: word_document
---

```{r, echo = FALSE, warning = FALSE}
library(knitr)
knitr::opts_chunk$set(cache = TRUE, warning = FALSE, message = FALSE, dpi = 180)
knitr::opts_chunk$set(echo = FALSE)
options(width=80, dplyr.width = 150)
library(ggplot2)
theme_set(theme_light())
```

Before we make some pretty tables, let's read in the data.

```{r}
library(readr)
library(forcats)
library(dplyr)
library(reshape2)
gpf_ppt <- read_csv("../data/gpf_ppt_merged.csv", 
                    col_types = cols(.default = col_character()))
dim(gpf_ppt)

gpf_ppt <- gpf_ppt %>%
    filter(round %in% c('1.0', '5.0')) %>%
    mutate(round_month = fct_recode(round,
                              `Jul 2014` = '1.0',
                              `Jul 2016` = '5.0')) %>%
    mutate(household_type = fct_collapse(household_type,
                                         Treatment = c("1", "2", "3"),
                                         Control = c("4", "5", "6")))

gpf_ppt[,c(1,27:35,36,273:276,326)] <- lapply(gpf_ppt[,c(1,27:35,36,273:276,326)], as.numeric)
```

## Make a Producers Data Frame

```{r}
producers <- bind_rows(gpf_ppt %>% 
                           filter(round_month == 'Jul 2014') %>% 
                           distinct(entry_id, .keep_all = TRUE),
                       gpf_ppt %>%
                           filter(round_month == 'Jul 2016') %>%
                           distinct(household_type, deo_id, round, .keep_all = TRUE)) %>%
    ungroup
                    
dim(producers)    
```

## 1. Fodder â€“ who is involved, types cultivated

```{r, fig.width=8, fig.height=4}
library(tidyr)
producers <- producers %>%
    mutate(are_you_cultivating_fodder = fct_recode(are_you_cultivating_fodder,
                              `Yes` = '1',
                              `No` = '2',
                              `Do not know how to cultivate` = '3',
                              `Have no land/scope` = '0')) %>%
    mutate(are_you_cultivating_fodder = fct_relevel(are_you_cultivating_fodder, 
                                                    "Yes", "No", "Do not know how to cultivate"))

totals <- producers %>% 
    group_by(round_month, household_type, are_you_cultivating_fodder) %>% 
    summarise(n = n()) %>% 
    filter(!is.na(are_you_cultivating_fodder) & are_you_cultivating_fodder != '9') %>%
    group_by(round_month, household_type) %>% 
    summarise(total = sum(n, na.rm = TRUE))


df <- producers %>% 
    group_by(round_month, household_type, are_you_cultivating_fodder) %>% 
    summarise(n = n()) %>%
    filter(!is.na(are_you_cultivating_fodder) & are_you_cultivating_fodder != '9') %>%
    left_join(totals, by = c("round_month", "household_type")) %>%
    mutate(prop = n / total*100) %>%
    select(-n, -total) %>%
    complete(are_you_cultivating_fodder) %>%
    filter(are_you_cultivating_fodder != "9")
 
df %>%
    kable(digits = 1,
          col.names = c("Round of Data Collection", "Treatment/Control",
                        "Are You Cultivating Fodder?", "Percent"),
          caption = "Treatment and Control Groups at the First and Last Data Collection Rounds")


df %>%
    filter(are_you_cultivating_fodder %in% c("Yes","No")) %>%
    ggplot(aes(round_month, prop/100, fill = are_you_cultivating_fodder)) +
    geom_bar(alpha = 0.8, stat = "identity", position = "dodge") +
    facet_wrap(~household_type) +
    labs(x = NULL, y = "Are You Cultivating Fodder?") +
    scale_y_continuous(labels = scales::percent_format()) +
    theme(legend.title=element_blank()) +
    scale_fill_manual(values = c("#66c2a5", "#d53e4f"))

```

```{r, fig.width=8, fig.height=4}
producers$type_fodder_cultivating[producers$type_fodder_cultivating == 0] <- NA
producers <- producers %>%
    mutate(type_fodder_cultivating = fct_recode(type_fodder_cultivating,
                              Napier = '1',
                              Sorghum = '2',
                              Maize = '3',
                              German = '5',
                              Jamboo = '6',
                              `Kheshari/MatiKalai` = '7',
                              Other = '9')) %>%
    mutate(type_fodder_cultivating = fct_collapse(type_fodder_cultivating,
                                                  Multiple = c("1,2",
                                                               "1,3",
                                                               "1,3,4",
                                                               "1,3,7",
                                                               "1,5",
                                                               "1,5,6",
                                                               "1,6",
                                                               "1,6,7",
                                                               "1,7",
                                                               "1.7",
                                                               "14",
                                                               "1m6",
                                                               "1,99",
                                                               "2,3",
                                                               "2,7",
                                                               "3,1",
                                                               "3,6",
                                                               "6,7",
                                                               "6,1"))) %>%
    mutate(type_fodder_cultivating = fct_relevel(type_fodder_cultivating,
                                                 "German",
                                                 "Jamboo", 
                                                 "Kheshari/MatiKalai", 
                                                 "Maize", 
                                                 "Napier",
                                                 "Sorghum",
                                                 "Other",
                                                 "Multiple"))

totals <- producers %>% 
    group_by(round_month, household_type, type_fodder_cultivating) %>% 
    summarise(n = n()) %>% 
    filter(!is.na(type_fodder_cultivating)) %>%
    group_by(round_month, household_type) %>% 
    summarise(total = sum(n, na.rm = TRUE))


df <- producers %>% 
    group_by(round_month, household_type, type_fodder_cultivating) %>% 
    summarise(n = n()) %>%
    filter(!is.na(type_fodder_cultivating)) %>%
    left_join(totals, by = c("round_month", "household_type")) %>%
    mutate(prop = n / total*100) %>%
    select(-n, -total) %>%
    complete(type_fodder_cultivating)
 
df %>%
    kable(digits = 1,
          col.names = c("Round of Data Collection", "Treatment/Control",
                        "What Type of Fodder Are You Cultivating?", "Percent"),
          caption = "Treatment and Control Groups at the First and Last Data Collection Rounds")

ggplot(df, aes(round_month, prop/100, fill = type_fodder_cultivating)) +
    geom_bar(alpha = 0.8, stat = "identity", position = "dodge") +
    facet_wrap(~household_type) +
    labs(x = NULL, y = "What Type of Fodder Are You Cultivating?") +
    scale_y_continuous(labels = scales::percent_format()) +
    theme(legend.title=element_blank()) +
    scale_fill_brewer(palette = "Spectral")

```

## 2. Green Grass

```{r, fig.height=4, fig.width=8}
producers <- producers %>%
    mutate(do_you_feed_green_grass_to_cow = fct_recode(do_you_feed_green_grass_to_cow,
                              `Yes` = '1',
                              `No` = '2'))

totals <- producers %>% 
    group_by(round_month, household_type, do_you_feed_green_grass_to_cow) %>% 
    summarise(n = n()) %>% 
    ungroup %>%
    filter(!is.na(do_you_feed_green_grass_to_cow)) %>%
    group_by(round_month, household_type) %>% 
    summarise(total = sum(n, na.rm = TRUE)) %>%
    ungroup


df <- producers %>% 
    group_by(round_month, household_type, do_you_feed_green_grass_to_cow) %>% 
    summarise(n = n()) %>%
    filter(!is.na(do_you_feed_green_grass_to_cow)) %>%
    left_join(totals, by = c("round_month", "household_type")) %>%
    mutate(prop = n / total*100) %>%
    select(-n, -total,
           round_month, household_type, do_you_feed_green_grass_to_cow, prop)
 
df %>%
    kable(digits = 1,
          col.names = c("Round of Data Collection", "Treatment/Control",
                        "Do You Feed Green Grass to Your Cattle?", "Percent"),
          caption = "Treatment and Control Groups at the First and Last Data Collection Rounds")

ggplot(df, aes(round_month, prop/100, fill = do_you_feed_green_grass_to_cow)) +
    geom_bar(alpha = 0.8, stat = "identity", position = "dodge") +
    facet_wrap(~household_type) +
    labs(x = NULL, y = "Do You Feed Green Grass to Your Cattle?") +
    scale_y_continuous(labels = scales::percent_format()) +
    theme(legend.title=element_blank()) +
    scale_fill_manual(values = c("#66c2a5", "#d53e4f"))

```

```{r, fig.height=4, fig.width=8}
producers$source_grass[producers$source_grass == 0] <- NA
producers$source_grass[producers$source_grass == '5'] <- NA

producers <- producers %>%
    mutate(source_grass = fct_recode(source_grass,
                              `Own production` = '1',
                              Purchase = '2',
                              `Collected road side/field` = '3',
                              Grazing = '4')) %>%
    mutate(source_grass = fct_collapse(source_grass,
                                       Multiple = c("1,2",
                                                    "1,2,3",
                                                    "1,2,4",
                                                    "1,3",
                                                    "1,4",
                                                    "1,6",
                                                    "1,9",
                                                    "1.,2",
                                                    "1.2",
                                                    "1.3",
                                                    "1.4",
                                                    "14,2",
                                                    "1m2",
                                                    "1m3",
                                                    "2,1",
                                                    "2,3",
                                                    "2,4",
                                                    "2,8",
                                                    "3,2",
                                                    "3,4",
                                                    "3,8",
                                                    "3.4",
                                                    "4,3"))) %>%
    mutate(source_grass = fct_relevel(source_grass,
                                      "Own production",
                                      "Purchase",
                                      "Collected road side/field",
                                      "Grazing",
                                      "Multiple"))

totals <- producers %>% 
    group_by(round_month, household_type, source_grass) %>% 
    summarise(n = n()) %>%
    ungroup %>%
    filter(!is.na(source_grass)) %>%
    group_by(round_month, household_type) %>% 
    summarise(total = sum(n, na.rm = TRUE)) %>%
    ungroup


df <- producers %>% 
    group_by(round_month, household_type, source_grass) %>% 
    summarise(n = n()) %>%
    ungroup %>%
    filter(!is.na(source_grass)) %>%
    left_join(totals, by = c("round_month", "household_type")) %>%
    mutate(prop = n / total*100) %>%
    select(-n, -total) %>%
    complete(source_grass) %>%
    select(round_month, household_type, source_grass, prop)

 
df %>%
    kable(digits = 1,
          col.names = c("Round of Data Collection", "Treatment/Control",
                        "Source of Grass", "Percent"),
          caption = "Treatment and Control Groups at the First and Last Data Collection Rounds")

ggplot(df, aes(round_month, prop/100, fill = source_grass)) +
    geom_bar(alpha = 0.8, stat = "identity", position = "dodge") +
    facet_wrap(~household_type) +
    labs(x = NULL, y = "Source of Grass") +
    scale_y_continuous(labels = scales::percent_format()) +
    theme(legend.title=element_blank()) +
    scale_fill_brewer(palette = "Spectral")
    
```

## 3. Deworming

```{r, fig.height=4, fig.width=8}
producers$have_you_dewormed_cattle_in_last_6_months[producers$have_you_dewormed_cattle_in_last_6_months == 0] <- NA
producers <- producers %>%
    mutate(have_you_dewormed_cattle_in_last_6_months = fct_recode(have_you_dewormed_cattle_in_last_6_months,
                                                                  `Yes` = '1',
                                                                  `No` = '2'))

totals <- producers %>% 
    group_by(round_month, household_type, have_you_dewormed_cattle_in_last_6_months) %>% 
    summarise(n = n()) %>% 
    ungroup %>%
    filter(!is.na(have_you_dewormed_cattle_in_last_6_months)) %>%
    group_by(round_month, household_type) %>% 
    summarise(total = sum(n, na.rm = TRUE)) %>%
    ungroup


df <- producers %>% 
    group_by(round_month, household_type, have_you_dewormed_cattle_in_last_6_months) %>% 
    summarise(n = n()) %>%
    ungroup %>%
    filter(!is.na(have_you_dewormed_cattle_in_last_6_months)) %>%
    left_join(totals, by = c("round_month", "household_type")) %>%
    mutate(prop = n / total*100) %>%
    select(-n, -total)
 
df %>%
    kable(digits = 1,
          col.names = c("Round of Data Collection", "Treatment/Control",
                        "Have You Dewormed Your Cattle (Last 6 Months)?", "Percent"),
          caption = "Treatment and Control Groups at the First and Last Data Collection Rounds")

ggplot(df, aes(round_month, prop/100, fill = have_you_dewormed_cattle_in_last_6_months)) +
    geom_bar(alpha = 0.8, stat = "identity", position = "dodge") +
    facet_wrap(~household_type) +
    labs(x = NULL, y = "Have You Dewormed Your Cattle (Last 6 Months)?") +
    scale_y_continuous(labels = scales::percent_format()) +
    theme(legend.title=element_blank()) +
    scale_fill_manual(values = c("#66c2a5", "#d53e4f"))

```


## 4. Washing

```{r, fig.height=4, fig.width=8}
producers <- producers %>% ungroup
producers$do_you_wash_cattle[producers$do_you_wash_cattle == 0] <- NA
producers <- producers %>%
    mutate(do_you_wash_cattle = fct_recode(do_you_wash_cattle,
                                           `Yes` = '1',
                                           `No` = '2'))

totals <- producers %>% 
    group_by(round_month, household_type, do_you_wash_cattle) %>% 
    summarise(n = n()) %>% 
    ungroup %>%
    filter(!is.na(do_you_wash_cattle)) %>%
    group_by(round_month, household_type) %>% 
    summarise(total = sum(n, na.rm = TRUE)) %>%
    ungroup


df <- producers %>% 
    group_by(round_month, household_type, do_you_wash_cattle) %>% 
    summarise(n = n()) %>%
    filter(!is.na(do_you_wash_cattle)) %>%
    left_join(totals, by = c("round_month", "household_type")) %>%
    mutate(prop = n / total*100) %>%
    select(-n, -total)
 
df %>%
    kable(digits = 1,
          col.names = c("Round of Data Collection", "Treatment/Control",
                        "Do You Wash Your Cattle?", "Percent"),
          caption = "Treatment and Control Groups at the First and Last Data Collection Rounds")

ggplot(df, aes(round_month, prop/100, fill = do_you_wash_cattle)) +
    geom_bar(alpha = 0.8, stat = "identity", position = "dodge") +
    facet_wrap(~household_type) +
    labs(x = NULL, y = "Do You Wash Your Cattle?") +
    scale_y_continuous(labels = scales::percent_format()) +
    theme(legend.title=element_blank()) +
    scale_fill_manual(values = c("#66c2a5", "#d53e4f"))

```


## 5. Bio-Security

```{r, fig.width=8, fig.height=4}
producers$measurement_taken_for_bio_security[producers$measurement_taken_for_bio_security == 0] <- NA
producers <- producers %>%
    mutate(measurement_taken_for_bio_security = fct_recode(measurement_taken_for_bio_security,
                              `Mosquito net` = '1',
                              `Mosquito coil` = '2',
                              Smoke = '3',
                              None = '4',
                              `Finish insect killer powder/liquid` = '5',
                              Fan = '6',
                              Other = '9')) %>%
    mutate(measurement_taken_for_bio_security = fct_collapse(measurement_taken_for_bio_security,
                                                             Multiple = c("1,2",
                                                                          "1,2,3",
                                                                          "1,2,5",
                                                                          "1,2,6",
                                                                          "1,3",
                                                                          "1,5",
                                                                          "1,6",
                                                                          "2,1",
                                                                          "2,3",
                                                                          "2,3,4",
                                                                          "2,4",
                                                                          "2,5",
                                                                          "2,6",
                                                                          "2.3",
                                                                          "23",
                                                                          "3,2",
                                                                          "3,5",
                                                                          "5,1",
                                                                          "5,2"))) %>%
    mutate(measurement_taken_for_bio_security = fct_relevel(measurement_taken_for_bio_security,
                                      "Mosquito net",
                                      "Mosquito coil",
                                      "Finish insect killer powder/liquid",
                                      "Smoke",
                                      "Fan",
                                      "Other",
                                      "Multiple",
                                      "None"))

totals <- producers %>% 
    group_by(round_month, household_type, measurement_taken_for_bio_security) %>% 
    summarise(n = n()) %>% 
    ungroup %>%
    filter(!is.na(measurement_taken_for_bio_security)) %>%
    group_by(round_month, household_type) %>% 
    summarise(total = sum(n, na.rm = TRUE)) %>%
    ungroup


df <- producers %>% 
    group_by(round_month, household_type, measurement_taken_for_bio_security) %>% 
    summarise(n = n()) %>%
    ungroup %>%
    filter(!is.na(measurement_taken_for_bio_security)) %>%
    left_join(totals, by = c("round_month", "household_type")) %>%
    mutate(prop = n / total*100) %>%
    select(-n, -total) %>%
    complete(measurement_taken_for_bio_security) %>%
    select(round_month, household_type, measurement_taken_for_bio_security, prop)
 
df %>%
    kable(digits = 1,
          col.names = c("Round of Data Collection", "Treatment/Control",
                        "Measures Taken for Biosecurity", "Percent"),
          caption = "Treatment and Control Groups at the First and Last Data Collection Rounds")

ggplot(df, aes(round_month, prop/100, fill = measurement_taken_for_bio_security)) +
    geom_bar(alpha = 0.8, stat = "identity", position = "dodge") +
    facet_wrap(~household_type) +
    labs(x = NULL, y = "Measures Taken for Biosecurity") +
    scale_y_continuous(labels = scales::percent_format()) +
    theme(legend.title=element_blank()) +
    scale_fill_brewer(palette = "Spectral")

```


## 6. Vaccination

```{r, fig.height=4, fig.width=8}
producers <- producers %>%
    ungroup() %>%
    mutate(how_many_vaccines_should_be_given_for_cattle = fct_recode(how_many_vaccines_should_be_given_for_cattle,
                              `Don't know` = '0'))
totals <- producers %>% 
    group_by(round_month, household_type, how_many_vaccines_should_be_given_for_cattle) %>% 
    summarise(n = n()) %>% 
    ungroup %>%
    filter(!is.na(how_many_vaccines_should_be_given_for_cattle)) %>%
    group_by(round_month, household_type) %>% 
    summarise(total = sum(n, na.rm = TRUE)) %>%
    ungroup


df <- producers %>% 
    group_by(round_month, household_type, how_many_vaccines_should_be_given_for_cattle) %>% 
    summarise(n = n()) %>%
    ungroup %>%
    filter(!is.na(how_many_vaccines_should_be_given_for_cattle)) %>%
    left_join(totals, by = c("round_month", "household_type")) %>%
    mutate(prop = n / total*100) %>%
    select(-n, -total) %>%
    complete(how_many_vaccines_should_be_given_for_cattle) %>%
    select(round_month, household_type, how_many_vaccines_should_be_given_for_cattle, prop)
 
df %>%
    kable(digits = 1,
          col.names = c("Round of Data Collection", "Treatment/Control",
                        "How Many Vaccines Should Be Given to Cattle?", "Percent"),
          caption = "Treatment and Control Groups at the First and Last Data Collection Rounds")

ggplot(df, aes(round_month, prop/100, fill = how_many_vaccines_should_be_given_for_cattle)) +
    geom_bar(alpha = 0.8, stat = "identity", position = "dodge") +
    facet_wrap(~household_type) +
    labs(x = NULL, y = "How Many Vaccines Should Be Given to Cattle?") +
    scale_y_continuous(labels = scales::percent_format()) +
    theme(legend.title=element_blank()) +
    scale_fill_brewer(palette = "Spectral")

```

```{r, fig.height=4, fig.width=8}
producers <- producers %>% ungroup()
producers <- producers %>%
    mutate(which_vaccines_have_you_given_to_cattle = fct_recode(which_vaccines_have_you_given_to_cattle,
                              FMD = '1',
                              HS = '2',
                              `Black Quarter` = '3',
                              Anthrax = '4',
                              Pneumonia = '5',
                              `Worm disease` = '6',
                              None = '7',
                              `Not sure` = '8')) %>%
    mutate(which_vaccines_have_you_given_to_cattle = fct_collapse(which_vaccines_have_you_given_to_cattle,
                                                                  Multiple = c("1,2",
                                                                               "1,2,3",
                                                                               "1,2,3,4",
                                                                               "1,2,4",
                                                                               "1,2,6",
                                                                               "1,3",
                                                                               "1,3,4",
                                                                               "1,4",
                                                                               "1,5",
                                                                               "1,6",
                                                                               "2,4",
                                                                               "3,4",
                                                                               "4,1",
                                                                               "4,3",
                                                                               "61",
                                                                               "72",
                                                                               "Anthrax, Hs, Jora",
                                                                               "Antx, Bq, HS",
                                                                               "Antx, BQ, HS, FMD",
                                                                               "Antx, Fever",
                                                                               "Antx, FMD",
                                                                               "ANTX, FMD",
                                                                               "Antx, FS",
                                                                               "Antx, HS",
                                                                               "ANTX, HS, FMD",
                                                                               "Antx, HS, FMD, BQ",
                                                                               "Antx, Pneumonia",
                                                                               "Antx,BQ HS, FMD",
                                                                               "Antx,HS",
                                                                               "Badla, Hs",
                                                                               "BQ, Antx",
                                                                               "BQ, FMD",
                                                                               "BQ, FMD, Antx",
                                                                               "BQ, HS",
                                                                               "BQ,HS,FMD",
                                                                               "FMD, BQ",
                                                                               "FMD, HS",
                                                                               "FMD,BQ",
                                                                               "Food & Mouth Disease, Anthrax",
                                                                               "Golafula, badla",
                                                                               "Golafula,khura",
                                                                               "Golafula,tarka,khura",
                                                                               "Hemorrhagic Septicemia, Anthrax",
                                                                               "Hemorrhagic Septicemia, Food & Mouth Disease, Black Quarter",
                                                                              "HS, Antx",
                                                                              "HS, ANTX",
                                                                              "HS, Antx, BQ",
                                                                              "Hs, Badla",
                                                                              "HS, BQ, Antx",
                                                                              "HS, BQ, FMD",
                                                                              "khura, badla",
                                                                              "Khura, golafula.",
                                                                              "Khura, Pochamina",
                                                                              "Khura, tarka,",
                                                                              "Khura, torka",
                                                                              "Khura,Anthrox",
                                                                              "khura,tarka",
                                                                              "Khura,Torka",
                                                                              "Khura, badla.",
                                                                              "Khura, Janan",
                                                                              "Khura, Tarka",
                                                                              "khura, tarka.",
                                                                              "Khura, Torka",
                                                                              "Khura, torka.",
                                                                              "Khura,badla,Torka",
                                                                              "Khura,tarka,badla,golafula",
                                                                              "Pox, HS",
                                                                              "Tarka, khura",
                                                                              "Tarka,khura",
                                                                              "Torka, Badla",
                                                                              "Torka, Hs",
                                                                              "Torka,Golafula",
                                                                              "Torka,Jora",
                                                                              "Torka,Khura",
                                                                              "Worm, Vitamin",
                                                                              "Hs, Golafula, Torka, Badla",
                                                                              "Hs, Torka",
                                                                              "HS,BQ",
                                                                              "HS,BQ,Antx,FMD",
                                                                              "Khura, torka,",
                                                                              "Fever, FMD"))) %>%
    mutate(which_vaccines_have_you_given_to_cattle = fct_collapse(which_vaccines_have_you_given_to_cattle,
                                                                  FMD = c("FMD",
                                                                          '1.',
                                                                          "Food & Mouth Disease",
                                                                          "Foot & Mouth disease"))) %>%
    mutate(which_vaccines_have_you_given_to_cattle = fct_collapse(which_vaccines_have_you_given_to_cattle,
                                                                  HS = c("HS",
                                                                         '2.',
                                                                         "For Hs",
                                                                         "Hs",
                                                                         "vaccin of Hs",
                                                                         "Vaccin of Hs deases",
                                                                         "Vaccine for Hs",
                                                                         "Disease of Hs",
                                                                         "Vaccine of Hs"))) %>%
    mutate(which_vaccines_have_you_given_to_cattle = fct_collapse(which_vaccines_have_you_given_to_cattle,
                                                                  Anthrax = c("Anthrax",
                                                                              '4.',
                                                                              "Antex",
                                                                              "Antharax",
                                                                              "Antx",
                                                                              "ANTX"))) %>%
    mutate(which_vaccines_have_you_given_to_cattle = fct_collapse(which_vaccines_have_you_given_to_cattle,
                                                                  `Not sure` = c("Not sure",
                                                                                 "No idea about disease",
                                                                                 "Do not know",
                                                                                 "No idea about this subject",
                                                                                 "Given but can't remember" ,
                                                                                 "Can not child",
                                                                                 "Given,can not speak",
                                                                                 "Given but don't know",
                                                                                 "Given,do not know",
                                                                                 "Given,Do not know",
                                                                                 "Given,Do not Know",
                                                                                 "Give, but he is not say.",
                                                                                 "Don't know",
                                                                                 "Can't speak about the viccan that given",
                                                                                 "Can't tell about the vaccine that given"))) %>%
    mutate(which_vaccines_have_you_given_to_cattle = fct_collapse(which_vaccines_have_you_given_to_cattle,
                                                                  None = c("0", "None",
                                                                           "Did not given",
                                                                           "Didn't give",
                                                                           "Do not Give",
                                                                           "Do Not Give",
                                                                           "Do not give.",
                                                                           "Don't give",
                                                                           "Don't given",
                                                                           "Donâ€™t give",
                                                                           "Donâ€™t give.",
                                                                           "no", "No", "NO",
                                                                           "No give", 
                                                                           "No need any vaccine",
                                                                           "No provide vaccine",
                                                                           "No provide Vaccine",
                                                                           "No Provide vaccine",
                                                                           "No vaccinaton",
                                                                           "No vaccine",
                                                                           "Don't provide vaccine",
                                                                           "No.", 
                                                                           "not given", "Not given",
                                                                           "not given any vaccine",
                                                                           "not given vaccine",
                                                                           "Provide no vaccine",
                                                                           "Provide no Vaccine"))) %>%
    mutate(which_vaccines_have_you_given_to_cattle = fct_lump(which_vaccines_have_you_given_to_cattle,
                                                              n = 6)) %>%
    mutate(which_vaccines_have_you_given_to_cattle = fct_relevel(which_vaccines_have_you_given_to_cattle,
                                      "FMD",
                                      "HS",
                                      "Anthrax",
                                      "Other",
                                      "Multiple",
                                      "Not sure",
                                      "None"))


totals <- producers %>% 
    group_by(round_month, household_type, which_vaccines_have_you_given_to_cattle) %>% 
    summarise(n = n()) %>% 
    ungroup() %>%
    filter(!is.na(which_vaccines_have_you_given_to_cattle)) %>%
    group_by(round_month, household_type) %>% 
    summarise(total = sum(n, na.rm = TRUE)) %>%
    ungroup()


df <- producers %>% 
    group_by(round_month, household_type, which_vaccines_have_you_given_to_cattle) %>% 
    summarise(n = n()) %>%
    ungroup() %>%
    filter(!is.na(which_vaccines_have_you_given_to_cattle)) %>%
    left_join(totals, by = c("round_month", "household_type")) %>%
    mutate(prop = n / total*100) %>%
    select(-n, -total) %>%
    complete(which_vaccines_have_you_given_to_cattle) %>%
    select(round_month, household_type, which_vaccines_have_you_given_to_cattle, prop)
 
df %>%
    kable(digits = 1,
          col.names = c("Round of Data Collection", "Treatment/Control",
                        "Which Vaccines Have You Given (Last 6 Months)?", "Percent"),
          caption = "Treatment and Control Groups at the First and Last Data Collection Rounds")

ggplot(df, aes(round_month, prop/100, fill = which_vaccines_have_you_given_to_cattle)) +
    geom_bar(alpha = 0.8, stat = "identity", position = "dodge") +
    facet_wrap(~household_type) +
    labs(x = NULL, y = "Which Vaccines Have You Given (Last 6 Months)?") +
    scale_y_continuous(labels = scales::percent_format()) +
    theme(legend.title=element_blank()) +
    scale_fill_brewer(palette = "Spectral")
```

## 7. Artificial Insemination (usage, costs, and source)

```{r, fig.height=4, fig.width=8}
producers$provided_ai_2[producers$provided_ai_2 == '22'] <- '2'
producers <- producers %>%
    mutate(provided_ai_2 = fct_recode(provided_ai_2,
                                           `Yes` = '1',
                                           `No` = '2'))

totals <- producers %>% 
    group_by(round_month, household_type, provided_ai_2) %>% 
    summarise(n = n()) %>% 
    filter(!is.na(provided_ai_2)) %>%
    group_by(round_month, household_type) %>% 
    summarise(total = sum(n, na.rm = TRUE))


df <- producers %>% 
    group_by(round_month, household_type, provided_ai_2) %>% 
    summarise(n = n()) %>%
    filter(!is.na(provided_ai_2)) %>%
    left_join(totals, by = c("round_month", "household_type")) %>%
    mutate(prop = n / total*100) %>%
    select(-n, -total)
 
df %>%
    kable(digits = 1,
          col.names = c("Round of Data Collection", "Treatment/Control",
                        "Usage of Artificial Insemination", "Percent"),
          caption = "Treatment and Control Groups at the First and Last Data Collection Rounds")

ggplot(df, aes(round_month, prop/100, fill = provided_ai_2)) +
    geom_bar(alpha = 0.8, stat = "identity", position = "dodge") +
    facet_wrap(~household_type) +
    labs(x = NULL, y = "Usage of Artificial Insemination") +
    scale_y_continuous(labels = scales::percent_format()) +
    theme(legend.title=element_blank()) +
    scale_fill_manual(values = c("#66c2a5", "#d53e4f"))
    
```

```{r, fig.height=4, fig.width=8}
producers$provided_ai_4[producers$provided_ai_4 == '6'] <- NA
producers$provided_ai_4[producers$provided_ai_4 == '8'] <- NA
producers$provided_ai_4[producers$provided_ai_4 == '9'] <- NA
producers$provided_ai_4[producers$provided_ai_4 == '0'] <- NA
producers <- producers %>%
    mutate(provided_ai_4 = fct_recode(provided_ai_4,
                                      `Own bull` = '1',
                                      `Other farmer's bull` = '2',
                                      `Goverment AI` = '3',
                                      `NGO AI` = '4',
                                      `Private AI` = '5'))

totals <- producers %>% 
    group_by(round_month, household_type, provided_ai_4) %>% 
    summarise(n = n()) %>% 
    filter(!is.na(provided_ai_4)) %>%
    group_by(round_month, household_type) %>% 
    summarise(total = sum(n, na.rm = TRUE))


df <- producers %>% 
    group_by(round_month, household_type, provided_ai_4) %>% 
    summarise(n = n()) %>%
    filter(!is.na(provided_ai_4)) %>%
    left_join(totals, by = c("round_month", "household_type")) %>%
    mutate(prop = n / total*100) %>%
    select(-n, -total) %>%
    complete(provided_ai_4)
 
df %>%
    kable(digits = 1,
          col.names = c("Round of Data Collection", "Treatment/Control",
                        "Who Provided Artificial Insemination Service?", "Percent"),
          caption = "Treatment and Control Groups at the First and Last Data Collection Rounds")

ggplot(df, aes(round_month, prop/100, fill = provided_ai_4)) +
    geom_bar(alpha = 0.8, stat = "identity", position = "dodge") +
    facet_wrap(~household_type) +
    labs(x = NULL, y = "Who Provided Artificial Insemination Service?") +
    scale_y_continuous(labels = scales::percent_format()) +
    theme(legend.title=element_blank()) +
    scale_fill_brewer(palette = "Spectral")

```


```{r, fig.height=4, fig.width=5.5}
producers$provided_ai_9[producers$provided_ai_9 == '0'] <- NA

producers <- producers %>%
    mutate(provided_ai_9 = as.numeric(provided_ai_9))

df <- producers %>% 
    group_by(round_month, household_type) %>% 
    summarise(median1 = median(provided_ai_9, na.rm = TRUE))
 
df %>%
    kable(digits = 1,
          col.names = c("Round of Data Collection", "Treatment/Control",
                        "Total Expenditure on Artificial Insemination (Median)"),
          caption = "Treatment and Control Groups at the First and Last Data Collection Rounds")

ggplot(df, aes(round_month, median1, fill = household_type)) +
    geom_bar(alpha = 0.8, stat = "identity", position = "dodge") +
    labs(x = NULL, y = "Total Expenditure on Artificial Insemination (Median)") +
    theme(legend.title=element_blank()) +
    scale_fill_manual(values = c("#3288bd", "#f46d43"))
```

## 8. Diet of the herd (breakdown of what the cows eat and farmer expenditure on cattle diet)

How many cows eat each of the 13 things?

```{r, fig.width=8, fig.height=4}
df <- gpf_ppt %>% 
    group_by(round_month, household_type) %>% 
    summarize(`Rice Bran` = 100*mean(!is.na(amount_rice_bran) & amount_rice_bran != '0'),
              `Wheat Bran` = 100*mean(!is.na(amount_wheat_bran) & amount_wheat_bran != '0'),
              `Pulse Husk` = 100*mean(!is.na(amount_pulse_husk) & amount_pulse_husk != '0'),
              `Broken Rice` = 100*mean(!is.na(amount_broken_rice) & amount_broken_rice != '0'),
              `Molasses` = 100*mean(!is.na(amount_molasess) & amount_molasess != '0'),
              `Broken Maize` = 100*mean(!is.na(amount_broken_maize) & amount_broken_maize != '0'),
              `Coconut Oil Cake` = 100*mean(!is.na(amount_coconut_oil_cake) & amount_coconut_oil_cake != '0'),
              `Mustard Oil Cake` = 100*mean(!is.na(amount_mustard_oil_cake) & amount_mustard_oil_cake != '0'),
              `Mineral Mix` = 100*mean(!is.na(amount_mineral_mix) & amount_mineral_mix != '0'),
              `DCP` = 100*mean(!is.na(amount_dcp) & amount_dcp != '0'),
              `Straw` = 100*mean(!is.na(amount_straw) & amount_straw != '0'),
              `Green Grass` = 100*mean(!is.na(amount_green_grass) & amount_green_grass != '0'),
              `Ready Feed` = 100*mean(!is.na(amount_ready_feed) & amount_ready_feed != '0'))

df %>%
    kable(digits = 1,
          col.names = c("Round of Data Collection", "Treatment/Control",
                        "Percent of Cows Who Eat Rice Bran",
                        "Percent of Cows Who Eat Wheat Bran",
                        "Percent of Cows Who Eat Pulse Husk",
                        "Percent of Cows Who Eat Broken Rice",
                        "Percent of Cows Who Eat Molasses",
                        "Percent of Cows Who Eat Broken Maize",
                        "Percent of Cows Who Eat Coconut Oil Cake",
                        "Percent of Cows Who Eat Mustard Oil Cake",
                        "Percent of Cows Who Eat Mineral Mix",
                        "Percent of Cows Who Eat DCP",
                        "Percent of Cows Who Eat Straw",
                        "Percent of Cows Who Eat Green Grass",
                        "Percent of Cows Who Eat Ready Feed"),
          caption = "Treatment and Control Groups at the First and Last Data Collection Rounds")


melt(df) %>% 
    filter(!(variable %in% c("Molasses", "DCP"))) %>%
    ggplot(aes(round_month, value/100, fill = variable)) +
    geom_bar(alpha = 0.8, stat = "identity", position = "dodge") +
    facet_wrap(~ household_type) +
    labs(x = NULL, y = "Percent of Cows Whose Diet Contains Each Item") +
    scale_y_continuous(labels = scales::percent_format()) +
    theme(legend.title=element_blank()) +
    scale_fill_brewer(palette = "Spectral")
```


## 9. Relationship between expenditure on cow diet and cow production levels

Dot for each herd: expenditure on diet vs. herd production (4 plots)

```{r, fig.height=8, fig.width=8}
gpf_ppt <- gpf_ppt %>%
    mutate(taka_total = as.numeric(taka_total))

df <- bind_rows(gpf_ppt %>% 
              filter(round_month == 'Jul 2014') %>% 
              group_by(household_type, entry_id) %>% 
              summarize(production = sum(cow_daily_production, na.rm = TRUE),
                        expenditure = max(taka_total)) %>% 
              mutate(deo_id = entry_id,
                     round_month = 'Jul 2014'),
          gpf_ppt %>% 
              filter(round_month == 'Jul 2016') %>% 
              group_by(household_type, deo_id) %>% 
              summarize(production = sum(cow_daily_production, na.rm = TRUE),
                        expenditure = max(taka_total)) %>% 
              mutate(round_month = 'Jul 2016')) %>%
    ungroup

df$production[df$production == 0] <- NA
df$expenditure[df$expenditure == 0] <- NA

ggplot(df, aes(expenditure, production, color = household_type)) +
    stat_smooth(method = "lm", se = FALSE, color = "gray70", linetype = 2) +
    geom_point(alpha = 0.3, size = 2, show.legend = FALSE) +
    facet_grid(household_type ~ round_month) +
    scale_color_manual(values = c("#3288bd", "#f46d43")) +
    xlim(NA, 2e4) +
    ylim(NA, 70) +
    labs(x = "Total Expenditure on Diet in Taka", 
         y = "Daily Herd Production in Liters")
```



## 10. Cow purchase history â€“ proportion of farmers, median count by breed value

SKIP FOR NOW

## 11. Cow selling history â€“ proportion of farmers, median count by breed value

SKIP FOR NOW

## 12. Calf history

SKIP FOR NOW

## 13. Knowledge Scores

```{r, fig.height=4, fig.width=5.5}
producers$total_score_knowledge[producers$total_score_knowledge == '0'] <- NA

producers <- producers %>%
    mutate(total_score_knowledge = as.numeric(total_score_knowledge))

df <- producers %>% 
    group_by(round_month, household_type) %>% 
    summarise(median1 = median(total_score_knowledge, na.rm = TRUE))
 
df %>%
    kable(digits = 1,
          col.names = c("Round of Data Collection", "Treatment/Control",
                        "Median Total Knowledge Score"),
          caption = "Treatment and Control Groups at the First and Last Data Collection Rounds")

ggplot(df, aes(round_month, median1, fill = household_type)) +
    geom_bar(alpha = 0.8, stat = "identity", position = "dodge") +
    labs(x = NULL, y = "Median Total Knowledge Score") +
    theme(legend.title=element_blank()) +
    scale_fill_manual(values = c("#3288bd", "#f46d43"))
```


## 14. Practice Score

```{r, fig.height=4, fig.width=5.5}
producers$total_score_practice[producers$total_score_practice == '0'] <- NA

producers <- producers %>%
    mutate(total_score_practice = as.numeric(total_score_practice))

df <- producers %>% 
    group_by(round_month, household_type) %>% 
    summarise(median1 = median(total_score_practice, na.rm = TRUE))
 
df %>%
    kable(digits = 1,
          col.names = c("Round of Data Collection", "Treatment/Control",
                        "Median Total Practice Score"),
          caption = "Treatment and Control Groups at the First and Last Data Collection Rounds")

ggplot(df, aes(round_month, median1, fill = household_type)) +
    geom_bar(alpha = 0.8, stat = "identity", position = "dodge") +
    labs(x = NULL, y = "Median Total Practice Score") +
    theme(legend.title=element_blank()) +
    scale_fill_manual(values = c("#3288bd", "#f46d43"))
```


## 15. Source of financing of dairy activities

```{r, fig.width=8, fig.height=4}
producers <- producers %>%
    mutate(how_did_you_bear_dairy_related_expenses = fct_recode(how_did_you_bear_dairy_related_expenses,
                              Savings = '1',
                              Loan = '2',
                              `Government grant` = '3',
                              `NGO grant` = '4',
                              Donation = '5',
                              Other = '9')) %>%
    mutate(how_did_you_bear_dairy_related_expenses = fct_collapse(how_did_you_bear_dairy_related_expenses,
                                                             Multiple = c("1,2",
                                                                          "1,4"))) %>%
    mutate(how_did_you_bear_dairy_related_expenses = fct_relevel(how_did_you_bear_dairy_related_expenses,
                                      "Savings",
                                      "Loan",
                                      "Government grant",
                                      "NGO grant",
                                      "Donation",
                                      "Multiple",
                                      "Other"))

totals <- producers %>% 
    group_by(round_month, household_type, how_did_you_bear_dairy_related_expenses) %>% 
    summarise(n = n()) %>% 
    filter(!is.na(how_did_you_bear_dairy_related_expenses)) %>%
    group_by(round_month, household_type) %>% 
    summarise(total = sum(n, na.rm = TRUE))


df <- producers %>% 
    group_by(round_month, household_type, how_did_you_bear_dairy_related_expenses) %>% 
    summarise(n = n()) %>%
    filter(!is.na(how_did_you_bear_dairy_related_expenses)) %>%
    left_join(totals, by = c("round_month", "household_type")) %>%
    mutate(prop = n / total*100) %>%
    select(-n, -total) %>%
    complete(how_did_you_bear_dairy_related_expenses)
 
df %>%
    kable(digits = 1,
          col.names = c("Round of Data Collection", "Treatment/Control",
                        "Source of Dairy Activity Financing", "Percent"),
          caption = "Treatment and Control Groups at the First and Last Data Collection Rounds")

ggplot(df, aes(round_month, prop/100, fill = how_did_you_bear_dairy_related_expenses)) +
    geom_bar(alpha = 0.8, stat = "identity", position = "dodge") +
    facet_wrap(~household_type) +
    labs(x = NULL, y = "Source of Dairy Activity Financing") +
    scale_y_continuous(labels = scales::percent_format()) +
    theme(legend.title=element_blank()) +
    scale_fill_brewer(palette = "Spectral")

```

## 16. Size of loans

```{r, fig.height=4, fig.width=5.5}
producers$if_receive_any_loan_how_much_was_it_tk[producers$if_receive_any_loan_how_much_was_it_tk == '0'] <- NA

producers <- producers %>%
    mutate(if_receive_any_loan_how_much_was_it_tk = as.numeric(if_receive_any_loan_how_much_was_it_tk))

df <- producers %>% 
    group_by(round_month, household_type) %>% 
    summarise(median1 = median(if_receive_any_loan_how_much_was_it_tk, na.rm = TRUE))
 
df %>%
    kable(digits = 1,
          col.names = c("Round of Data Collection", "Treatment/Control",
                        "Median Size of Loan in Taka"),
          caption = "Treatment and Control Groups at the First and Last Data Collection Rounds")

ggplot(df, aes(round_month, median1, fill = household_type)) +
    geom_bar(alpha = 0.8, stat = "identity", position = "dodge") +
    labs(x = NULL, y = "Median Size of Loan in Taka") +
    theme(legend.title=element_blank()) +
    scale_fill_manual(values = c("#3288bd", "#f46d43"))
```

